@Library('pipelib@master') _

node {
  def root = pwd()

  state('Setup') {
    deleteDir()
    git([
      url: env.GIT_URL ? env.GIT_URL : 'https://github.com/venicegeo/dg-bf-tideprediction.git',
      branch: "master"
    ])
  }

  stage('Archive') {
    sh """
      virtualenv --python=/usr/bin/python3 .env
      . .env/bin/activate
      pip install -r ./requirements.txt
      ./scripts/extract-historical-data.sh
    """
  }

  stage('Staging Deploy') {
    cfPush()
  }
}

